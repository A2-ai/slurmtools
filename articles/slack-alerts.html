<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>slack-alerts • slurmtools</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="slack-alerts">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">slurmtools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-get-started" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Get Started</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-get-started">
<li><a class="dropdown-item" href="../articles/Running-nonmem.html">Running NONMEM</a></li>
    <li><a class="dropdown-item" href="../articles/custom-alerts.html">custom-alerts</a></li>
    <li><a class="dropdown-item" href="../articles/slack-alerts.html">slack-alerts</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/a2-ai/slurmtools"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>slack-alerts</h1>
            
      

      <div class="d-none name"><code>slack-alerts.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">slurmtools</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Needed slurmtools options</span> ───────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> option('slurmtools.slurm_job_template_path') is not set.</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> option('slurmtools.submission_root') is not set.</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> option('slurmtools.bbi_config_path') is not set.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please set all options for job submission defaults to work.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://metrumresearchgroup.github.io/bbr" class="external-link">bbr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; here() starts at /home/runner/work/slurmtools/slurmtools</span></span>
<span></span>
<span><span class="va">nonmem</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignettes"</span>, <span class="st">"model"</span>, <span class="st">"nonmem"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">'slurmtools.submission_root'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">nonmem</span>, <span class="st">"submission-log"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_number</span> <span class="op">&lt;-</span> <span class="st">"1001"</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">nonmem</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">mod_number</span>, <span class="st">".yaml"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">bbr</span><span class="fu">::</span><span class="fu"><a href="https://metrumresearchgroup.github.io/bbr/reference/read_model.html" class="external-link">read_model</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">nonmem</span>, <span class="va">mod_number</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">bbr</span><span class="fu">::</span><span class="fu"><a href="https://metrumresearchgroup.github.io/bbr/reference/new_model.html" class="external-link">new_model</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">nonmem</span>, <span class="va">mod_number</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level2">
<h2 id="cut-me-some-slack">Cut me some Slack<a class="anchor" aria-label="anchor" href="#cut-me-some-slack"></a>
</h2>
<p>There is also functionality to pair <code>nmm</code> with <a href="https://github.com/A2-ai/slack_notifier/releases/" class="external-link">slack_notifier</a>
and get messages sent directly to you via a slack bot. This requires you
to download the slack_notifier binaries and added them to your path so
<code>nmm</code> can find it. You can download the latest release and
extract the binary and again save it to <code>~/.local/bin</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Sys.which.html" class="external-link">Sys.which</a></span><span class="op">(</span><span class="st">"slack_notifier"</span><span class="op">)</span></span>
<span><span class="co">#&gt; slack_notifier </span></span>
<span><span class="co">#&gt;             ""</span></span></code></pre></div>
<p>slack_notifier requires an additional
<code>slack_notifier/config.yaml</code> file that contains the slack bot
OAuth token which is found from [<a href="%5Bhttps://api.slack.com/apps/%5D(https://api.slack.com/apps/)%7B.uri%7D" class="external-link uri">[https://api.slack.com/apps/\\](https://api.slack.com/apps/){.uri}</a>&lt;YOUR
APP ID&gt; /oauth?].</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode slack_notifier/config.yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">SLACK_OAUTH_TOKEN</span><span class="kw">:</span><span class="at"> </span><span class="st">"encrypted(Bot User OAuth Token)"</span></span></code></pre></div>
<p>Again, we need to update the <code>1001.toml</code> file to get slack
notifications. We need to set <code>alert = "slack"</code> and provide
the <code>email</code> associated with the slack account in
<code>generate_nmm_config</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">slurmtools</span><span class="fu">::</span><span class="fu"><a href="../reference/generate_nmm_config.html">generate_nmm_config</a></span><span class="op">(</span> </span>
<span>  <span class="va">mod</span>, </span>
<span>  alert <span class="op">=</span> <span class="st">"slack"</span>,</span>
<span>  email <span class="op">=</span> <span class="st">"matthews@a2-ai.com"</span>,</span>
<span>  watched_dir <span class="op">=</span> <span class="st">"/cluster-data/user-homes/matthews/Packages/slurmtools/vignettes/model/nonmem"</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="st">"/cluster-data/user-homes/matthews/Packages/slurmtools/vignettes/model/nonmem/in_progress"</span><span class="op">)</span></span></code></pre></div>
<p>This generates the following toml file:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode 1001.toml"><code class="sourceCode toml"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="dt">model_number</span> <span class="op">=</span> <span class="st">'</span><span class="vs">1001</span><span class="st">'</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="dt">files_to_track</span> <span class="op">=</span> <span class="op">[</span> <span class="st">'</span><span class="vs">lst</span><span class="st">'</span><span class="op">,</span> <span class="st">'</span><span class="vs">ext</span><span class="st">'</span><span class="op">,</span> <span class="st">'</span><span class="vs">grd</span><span class="st">'</span> <span class="op">]</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="dt">tmp_dir</span> <span class="op">=</span> <span class="st">'</span><span class="vs">/tmp</span><span class="st">'</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="dt">watched_dir</span> <span class="op">=</span> <span class="st">'</span><span class="vs">/cluster-data/user-homes/matthews/Packages/slurmtools/vignettes/model/nonmem</span><span class="st">'</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="dt">output_dir</span> <span class="op">=</span> <span class="st">'</span><span class="vs">/cluster-data/user-homes/matthews/Packages/slurmtools/vignettes/model/nonmem/in_progress</span><span class="st">'</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="dt">poll_duration</span> <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="dt">alert</span> <span class="op">=</span> <span class="st">'</span><span class="vs">Slack</span><span class="st">'</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="dt">level</span> <span class="op">=</span> <span class="st">'</span><span class="vs">Debug</span><span class="st">'</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="dt">email</span> <span class="op">=</span> <span class="st">'</span><span class="vs">matthews@a2-ai.com</span><span class="st">'</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="dt">threads</span> <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="dt">topic</span> <span class="op">=</span> <span class="st">''</span></span></code></pre></div>
<p>With <code>alert = 'Slack'</code> and <code>email</code> set in the
<code>1001.toml</code> file <code>nmm</code> will send slack
notifications directly to you when a NONMEM run starts and it will reply
to that message with notifications if any gradients hit 0 and when the
run finishes it checks if all -1E9 lines are present in the .ext file
and gives another message about any parameters that hit 0 gradient.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">submission_nmm</span> <span class="op">&lt;-</span> <span class="fu">slurmtools</span><span class="fu">::</span><span class="fu"><a href="../reference/submit_nonmem_model.html">submit_nonmem_model</a></span><span class="op">(</span> </span>
<span>  <span class="va">mod</span>, </span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  slurm_job_template_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">nonmem</span>, <span class="st">"slurm-job-nmm.tmpl"</span><span class="op">)</span>,</span>
<span>  slurm_template_opts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    nmm_exe_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/normalizePath.html" class="external-link">normalizePath</a></span><span class="op">(</span><span class="st">"~/.local/bin/nmm"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in normalizePath("~/.local/bin/nmm"):</span></span>
<span><span class="co">#&gt; path[1]="/home/runner/.local/bin/nmm": No such file or directory</span></span>
<span></span>
<span><span class="va">submission_nmm</span></span>
<span><span class="co">#&gt; $status</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $stdout</span></span>
<span><span class="co">#&gt; [1] "Submitted batch job 804\n"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $stderr</span></span>
<span><span class="co">#&gt; [1] ""</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $timeout</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">slurmtools</span><span class="fu">::</span><span class="fu"><a href="../reference/get_slurm_jobs.html">get_slurm_jobs</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; $submit_time</span></span>
<span><span class="co">#&gt; POSIXct of length 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $start_time</span></span>
<span><span class="co">#&gt; POSIXct of length 0</span></span></code></pre></div>
<div class="float">
<img src="data/images/nmm_slack_notifications.png" alt="nmm slack alerts"><div class="figcaption">nmm slack alerts</div>
</div>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Devin Pastoor, Jenna Elwing, Matthew Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
