<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>custom-alerts â€¢ slurmtools</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="custom-alerts">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">slurmtools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-get-started" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Get Started</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-get-started">
<li><a class="dropdown-item" href="../articles/Running-nonmem.html">Running NONMEM</a></li>
    <li><a class="dropdown-item" href="../articles/custom-alerts.html">custom-alerts</a></li>
    <li><a class="dropdown-item" href="../articles/slack-alerts.html">slack-alerts</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/a2-ai/slurmtools"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>custom-alerts</h1>
            
      

      <div class="d-none name"><code>custom-alerts.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(slurmtools)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>â”€â”€ â€©[<span class="dv">1</span>mNeeded slurmtools optionsâ€©[<span class="dv">22</span>m â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>â€©[<span class="dv">31</span>mâœ–â€©[<span class="dv">39</span>m <span class="fu">option</span>(<span class="st">'slurmtools.slurm_job_template_path'</span>) is not set.</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>â€©[<span class="dv">31</span>mâœ–â€©[<span class="dv">39</span>m <span class="fu">option</span>(<span class="st">'slurmtools.submission_root'</span>) is not set.</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>â€©[<span class="dv">31</span>mâœ–â€©[<span class="dv">39</span>m <span class="fu">option</span>(<span class="st">'slurmtools.bbi_config_path'</span>) is not set.</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>â€©[<span class="dv">36</span>mâ„¹â€©[<span class="dv">39</span>m Please set all options <span class="cf">for</span> job submission defaults to work.</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">library</span>(bbr)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="fu">here</span>() starts at <span class="sc">/</span>home<span class="sc">/</span>runner<span class="sc">/</span>work<span class="sc">/</span>slurmtools<span class="sc">/</span>slurmtools</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>nonmem <span class="ot">=</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">"vignettes"</span>, <span class="st">"model"</span>, <span class="st">"nonmem"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="fu">options</span>(<span class="st">'slurmtools.submission_root'</span> <span class="ot">=</span> <span class="fu">file.path</span>(nonmem, <span class="st">"submission-log"</span>))</span></code></pre></div>
<div class="section level2">
<h2 id="submitting-a-nonmem-job-with-nmm">Submitting a NONMEM job with nmm<a class="anchor" aria-label="anchor" href="#submitting-a-nonmem-job-with-nmm"></a>
</h2>
<p>Instead of using bbi we can use <code>nmm</code> (<a href="https://github.com/A2-ai/nonmem-monitor" class="external-link">NONMEM Monitor</a>) which
currently has some additional functionality of sending notifications
about zero gradients, missing -1E9 lines in ext file, and some very
basic control stream errors. Nonmem-monitor also allows for setting up
an alerter to be better fed these messages - more on that later. To use
<code>nmm</code> you can install the latest release from the github
repository linked above.</p>
<p>We can update the template file accordingly:</p>
<pre class="slurm-job-nmm.tmpl"><code>#!/bin/bash 
#SBATCH --job-name="{{job_name}}" 
#SBATCH --nodes=1 
#SBATCH --ntasks=1
#SBATCH --cpus-per-task={{ncpu}} 
#SBATCH --partition={{partition}}

{{nmm_exe_path}} -c {{config_toml_path}} run</code></pre>
<p>default, <code>submit_nonmem_model</code> will provide
<code>nmm_exe_path</code> and <code>config_toml_path</code> to the
template. Just like with <code>bbi_exe_path</code>,
<code>nmm_exe_path</code> is determined with
<code>Sys.which("nmm")</code> which may or may not give you the path to
the nmm binary if it is on your path or not. We can inject the
<code>nmm_exe_path</code> like we did with <code>bbi_exe_path</code> and
assume itâ€™s not on our path.</p>
<p>The <code>config.toml</code> file controls what <code>nmm</code> will
monitor and where to look for files and how to alert you. Weâ€™ll use
<code><a href="../reference/generate_nmm_config.html">generate_nmm_config()</a></code> to create this file. First we can
look at the documentation to see what type of information we should pass
to this function.</p>
<div class="float">
<img src="data%2Fimages%2Fgenerate_nmm_config_help.png" alt="documentation for generate_nmm_config()"><div class="figcaption">documentation for generate_nmm_config()</div>
</div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_number</span> <span class="op">&lt;-</span> <span class="st">"1001"</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">nonmem</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">mod_number</span>, <span class="st">".yaml"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">bbr</span><span class="fu">::</span><span class="fu"><a href="https://metrumresearchgroup.github.io/bbr/reference/read_model.html" class="external-link">read_model</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">nonmem</span>, <span class="va">mod_number</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">bbr</span><span class="fu">::</span><span class="fu"><a href="https://metrumresearchgroup.github.io/bbr/reference/new_model.html" class="external-link">new_model</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">nonmem</span>, <span class="va">mod_number</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">slurmtools</span><span class="fu">::</span><span class="fu"><a href="../reference/generate_nmm_config.html">generate_nmm_config</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span></code></pre></div>
<p>This generates the following toml file. By passing in just the mod
object, <code>nmm</code> will use the default values for the other
options so if you need to change which files are tracked, or how many
threads to use youâ€™ll have to explicitly pass that to
<code>generate_nmm_config</code>. Since weâ€™re in vignettes weâ€™ll need to
update the <code>watched_dir</code> and <code>output_dir</code>
accordingly.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode 1001.toml"><code class="sourceCode toml"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="dt">model_number</span> <span class="op">=</span> <span class="st">'</span><span class="vs">1001</span><span class="st">'</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="dt">watched_dir</span> <span class="op">=</span> <span class="st">'</span><span class="vs">/cluster-data/user-homes/matthews/Packages/slurmtools/model/nonmem</span><span class="st">'</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="dt">output_dir</span> <span class="op">=</span> <span class="st">'</span><span class="vs">/cluster-data/user-homes/matthews/Packages/slurmtools/model/nonmem/in_progress</span><span class="st">'</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">slurmtools</span><span class="fu">::</span><span class="fu"><a href="../reference/generate_nmm_config.html">generate_nmm_config</a></span><span class="op">(</span> </span>
<span>  <span class="va">mod</span>, </span>
<span>  watched_dir <span class="op">=</span> <span class="st">"/cluster-data/user-homes/matthews/Packages/slurmtools/vignettes/model/nonmem"</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="st">"/cluster-data/user-homes/matthews/Packages/slurmtools/vignettes/model/nonmem/in_progress"</span><span class="op">)</span></span></code></pre></div>
<p>This updates the <code>1001.toml</code> config file to:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode 1001.toml"><code class="sourceCode toml"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="dt">model_number</span> <span class="op">=</span> <span class="st">'</span><span class="vs">1001</span><span class="st">'</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="dt">watched_dir</span> <span class="op">=</span> <span class="st">'</span><span class="vs">/cluster-data/user-homes/matthews/Packages/slurmtools/vignettes/model/nonmem</span><span class="st">'</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="dt">output_dir</span> <span class="op">=</span> <span class="st">'</span><span class="vs">/cluster-data/user-homes/matthews/Packages/slurmtools/vignettes/model/nonmem/in_progress</span><span class="st">'</span></span></code></pre></div>
<p>We can now run <code>submit_nonmem_model</code> and get essentially
the same behavior as running with <code>bbi</code>. On linux
<code>~/.local/bin/</code> will be on your path so saving the downloaded
binaries there is a good approach.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>submission_nmm <span class="ot">&lt;-</span> slurmtools<span class="sc">::</span><span class="fu">submit_nonmem_model</span>( </span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  mod, </span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  <span class="at">slurm_job_template_path =</span> <span class="fu">file.path</span>(nonmem, <span class="st">"slurm-job-nmm.tmpl"</span>),</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  <span class="at">slurm_template_opts =</span> <span class="fu">list</span>(</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>    <span class="at">nmm_exe_path =</span> <span class="fu">normalizePath</span>(<span class="st">"~/.local/bin/nmm"</span>))</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>)</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>Warning <span class="cf">in</span> <span class="fu">normalizePath</span>(<span class="st">"~/.local/bin/nmm"</span>)<span class="sc">:</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>path[<span class="dv">1</span>]<span class="ot">=</span><span class="st">"/home/runner/.local/bin/nmm"</span><span class="sc">:</span> No such file or directory</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>submission_nmm</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="sc">$</span>status</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">0</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="sc">$</span>stdout</span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Submitted batch job 804</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="sc">$</span>stderr</span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">""</span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a><span class="sc">$</span>timeout</span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">FALSE</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>slurmtools<span class="sc">::</span><span class="fu">get_slurm_jobs</span>(<span class="at">user =</span> <span class="st">"matthews"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="sc">$</span>submit_time</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>POSIXct of length <span class="dv">0</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="sc">$</span>start_time</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>POSIXct of length <span class="dv">0</span></span></code></pre></div>
<p>The one difference between using <code>nmm</code> compared to
<code>bbi</code> is that a new directory is created that contains a log
file that caught some issues with our run. This file is updated as
nonmem is running and monitors gradient values, parameters that hit
zero, as well as other errors from bbi. Looking at the first few lines
we can see that <code>bbi</code> was successfully able to call nonmem.
We also see an info level log that OMEGA(2,1) has 0 value â€“ in our mod
file we donâ€™t specify any omega values off the diagonal so these are
fixed at 0. Finally we see that GRD(6) hit 0 relatively early in the
run.</p>
<pre class="vignettes/model/nonmem/in_progress/1001/modeling_run_20240827201226.log"><code>19:13:45 [INFO] bbi log: time="2024-09-20T19:13:45Z" level=info msg="Successfully loaded default configuration from /cluster-data/user-homes/matthews/Packages/slurmtools/vignettes/model/nonmem/bbi.yaml"
19:13:45 [INFO] bbi log: time="2024-09-20T19:13:45Z" level=info msg="Beginning Local Path"
19:13:45 [INFO] bbi log: time="2024-09-20T19:13:45Z" level=info msg="A total of 1 models have completed the initial preparation phase"
19:13:45 [INFO] bbi log: time="2024-09-20T19:13:45Z" level=info msg="[1001] Beginning local work phase"
19:14:16 [INFO] "/cluster-data/user-homes/matthews/Packages/slurmtools/vignettes/model/nonmem/1001/1001.ext": Iteration: 5, Parameter(s) that hit zero: ["SIGMA(2,1)", "OMEGA(2,1)"]
19:14:19 [INFO] "/cluster-data/user-homes/matthews/Packages/slurmtools/vignettes/model/nonmem/1001/1001.ext": Iteration: 10, Parameter(s) that hit zero: ["OMEGA(2,1)", "SIGMA(2,1)"]
19:14:21 [INFO] "/cluster-data/user-homes/matthews/Packages/slurmtools/vignettes/model/nonmem/1001/1001.ext": Iteration: 15, Parameter(s) that hit zero: ["SIGMA(2,1)", "OMEGA(2,1)"]
19:14:21 [WARN] "/cluster-data/user-homes/matthews/Packages/slurmtools/vignettes/model/nonmem/1001/1001.grd" Iteration: 10, has 0 gradient for parameter(s): ["GRD(6)"] </code></pre>
<p>After a run has finished several messages are sent to the log after a
final check of the files listed in the <code>files_to_track</code> field
of the <code>1001.toml</code> file.</p>
<pre class="vignettes/model/nonmem/in_progress/1001/modeling_run_20240827201226.log"><code>19:14:31 [INFO] Received Exit code: exit status: 0
19:14:31 [WARN] 1001.ext: Missing ext final output lines. Observed lines were: [-1000000000.0, -1000000004.0, -1000000006.0, -1000000007.0]
19:14:31 [WARN] "/cluster-data/user-homes/matthews/Packages/slurmtools/vignettes/model/nonmem/1001/1001.grd": The following parameters hit zero gradient through the run: ["GRD(6)"]</code></pre>
<p>We see that GRD(6) hit zero during the run and that only a subset of
the -1E9 lines were present in the .ext file.</p>
</div>
<div class="section level2">
<h2 id="getting-alerted-during-a-run">Getting alerted during a run<a class="anchor" aria-label="anchor" href="#getting-alerted-during-a-run"></a>
</h2>
<p>Like we did with <code>bbi</code> and altering the slurm template
file to get notifications from <a href="ntfy.sh">ntfy.sh</a>
<code>nmm</code> has this feature built in! The messages in the log file
that relate to zero gradients, missing -1E9 lines, and 0 parameter
values can also be sent to ntfy by altering the <code>1001.toml</code>
file. We can get these alerts in real time without having to dig through
a noisy log file.</p>
<p>Letâ€™s update our call to <code>generate_nmm_config</code> to have
<code>nmm</code> send notifications to the <code>NONMEMmonitor</code>
topic on <a href="ntfy.sh">ntfy.sh</a>. Just like how
<code>submit_nonmem_model</code> can feed additional information to the
template with <code>slurm_template_opts</code>, we can add an alerter
feature to nmm with <code>alerter_opts</code>. If we go to ntfy.sh we
can see that to send a message to ntfy we can run
<code>curl -d "Backup successful ðŸ˜€"  ntfy.sh/mytopic</code>.
<code>nmm</code> can call a binary with a command and pass a message to
a flag. For ntfy, the binary is <code>curl</code> the message flag is
<code>d</code> and the command is <code>ntfy.sh/mytopic</code> and there
are no additional args.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">slurmtools</span><span class="fu">::</span><span class="fu"><a href="../reference/generate_nmm_config.html">generate_nmm_config</a></span><span class="op">(</span> </span>
<span>  <span class="va">mod</span>, </span>
<span>  watched_dir <span class="op">=</span> <span class="st">"/cluster-data/user-homes/matthews/Packages/slurmtools/vignettes/model/nonmem"</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="st">"/cluster-data/user-homes/matthews/Packages/slurmtools/vignettes/model/nonmem/in_progress"</span>,</span>
<span>  alerter_opts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    alerter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.which.html" class="external-link">Sys.which</a></span><span class="op">(</span><span class="st">'curl'</span><span class="op">)</span>, <span class="co">#binary location of curl,</span></span>
<span>    command <span class="op">=</span> <span class="st">"ntfy.sh/NONMEMmonitor"</span>,</span>
<span>    message_flag <span class="op">=</span> <span class="st">"d"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This updates the <code>1001.toml</code> file to this:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode 1001.toml"><code class="sourceCode toml"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="dt">model_number</span> <span class="op">=</span> <span class="st">'</span><span class="vs">1001</span><span class="st">'</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="dt">watched_dir</span> <span class="op">=</span> <span class="st">'</span><span class="vs">/cluster-data/user-homes/matthews/Packages/slurmtools/vignettes/model/nonmem</span><span class="st">'</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="dt">output_dir</span> <span class="op">=</span> <span class="st">'</span><span class="vs">/cluster-data/user-homes/matthews/Packages/slurmtools/vignettes/model/nonmem/in_progress</span><span class="st">'</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="kw">[alerter]</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="dt">alerter</span> <span class="op">=</span> <span class="st">'</span><span class="vs">/usr/bin/curl</span><span class="st">'</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="dt">command</span> <span class="op">=</span> <span class="st">'</span><span class="vs">ntfy.sh/NONMEMmonitor</span><span class="st">'</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="dt">message_flag</span> <span class="op">=</span> <span class="st">'</span><span class="vs">d</span><span class="st">'</span></span></code></pre></div>
<p>When we re-run the <code>submit_nonmem_model</code> call we will now
get ntfy notifications. One thing to note is that <code>nmm</code> will
print full paths in the log, but will only send notifications with the
<code>model_number</code> (or
<code>model_number.file_extension</code>).</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>submission_nmm <span class="ot">&lt;-</span> slurmtools<span class="sc">::</span><span class="fu">submit_nonmem_model</span>( </span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  mod, </span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  <span class="at">slurm_job_template_path =</span> <span class="fu">file.path</span>(nonmem, <span class="st">"slurm-job-nmm.tmpl"</span>),</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>  <span class="at">slurm_template_opts =</span> <span class="fu">list</span>(</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>    <span class="at">nmm_exe_path =</span> <span class="fu">normalizePath</span>(<span class="st">"~/.local/bin/nmm"</span>))</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>)</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>Warning <span class="cf">in</span> <span class="fu">normalizePath</span>(<span class="st">"~/.local/bin/nmm"</span>)<span class="sc">:</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>path[<span class="dv">1</span>]<span class="ot">=</span><span class="st">"/home/runner/.local/bin/nmm"</span><span class="sc">:</span> No such file or directory</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>submission_nmm</span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a><span class="sc">$</span>status</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">0</span></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a><span class="sc">$</span>stdout</span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Submitted batch job 804</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a><span class="sc">$</span>stderr</span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">""</span></span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a><span class="sc">$</span>timeout</span>
<span id="cb14-22"><a href="#cb14-22" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">FALSE</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>slurmtools<span class="sc">::</span><span class="fu">get_slurm_jobs</span>(<span class="at">user =</span> <span class="st">"matthews"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="sc">$</span>submit_time</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>POSIXct of length <span class="dv">0</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="sc">$</span>start_time</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>POSIXct of length <span class="dv">0</span></span></code></pre></div>
<p>This gives us the notifications in a much more digestible format</p>
<div class="float">
<img src="data%2Fimages%2Fnmm_ntfy_alerts.png" alt="nmm ntfy.sh alerts"><div class="figcaption">nmm ntfy.sh alerts</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Devin Pastoor, Jenna Elwing, Matthew Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
