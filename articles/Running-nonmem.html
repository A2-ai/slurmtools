<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Running Nonmem with slurmtools • slurmtools</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Running Nonmem with slurmtools">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">slurmtools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-get-started" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Get Started</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-get-started">
<li><a class="dropdown-item" href="../articles/Running-nonmem.html">Running NONMEM</a></li>
    <li><a class="dropdown-item" href="../articles/custom-alerts.html">custom-alerts</a></li>
    <li><a class="dropdown-item" href="../articles/slack-alerts.html">slack-alerts</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/a2-ai/slurmtools"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Running Nonmem with slurmtools</h1>
            
      

      <div class="d-none name"><code>Running-nonmem.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="slurmtools-for-submitting-nonmem-runs">Slurmtools for submitting NONMEM runs<a class="anchor" aria-label="anchor" href="#slurmtools-for-submitting-nonmem-runs"></a>
</h2>
<p><code>slurmtools</code> is an R package for interacting with slurm
(fka <strong>S</strong>imple <strong>L</strong>inux
<strong>U</strong>tility for <strong>R</strong>esource
<strong>M</strong>anagement) and submitting NONMEM jobs. You can submit
a NONMEM job with <code>submit_nonmem_model</code>, you can view current
jobs with <code>get_slurm_jobs</code>, and you can see the available
partitions with <code>get_slurm_partitions</code>.</p>
<div class="section level3">
<h3 id="installing-slurmtools">Installing <code>slurmtools</code><a class="anchor" aria-label="anchor" href="#installing-slurmtools"></a>
</h3>
<p>To install <code>slurmtools</code> use the following commands:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(slurmtools)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>──  [<span class="dv">1</span>mNeeded slurmtools options [<span class="dv">22</span>m ───────────────────────────────────────────────────</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a> [<span class="dv">31</span>m✖ [<span class="dv">39</span>m <span class="fu">option</span>(<span class="st">'slurmtools.slurm_job_template_path'</span>) is not set.</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a> [<span class="dv">31</span>m✖ [<span class="dv">39</span>m <span class="fu">option</span>(<span class="st">'slurmtools.submission_root'</span>) is not set.</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a> [<span class="dv">31</span>m✖ [<span class="dv">39</span>m <span class="fu">option</span>(<span class="st">'slurmtools.bbi_config_path'</span>) is not set.</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a> [<span class="dv">36</span>mℹ [<span class="dv">39</span>m Please set all options <span class="cf">for</span> job submission defaults to work.</span></code></pre></div>
<p>We are given a message when loading slurmtools that some options are
not set and that default job submission will not work without them.
These options are used for default arguments in the
<code>submit_nonmem_model</code> function. Running
<code><a href="../reference/submit_nonmem_model.html">?submit_nonmem_model</a></code> we can see the documentation</p>
<div class="float">
<img src="data/images/submit_nonmem_model_help.png" alt="Help view for submit_nonmem_model function"><div class="figcaption">Help view for <code>submit_nonmem_model</code>
function</div>
</div>
<p>This function uses the inputs to populate a template Bash shell
script that submits the NONMEM job to slurm. A default template file is
supplied with the Project Starter and it can be modified to do
additional tasks as long as they are possible within Bash.</p>
<p>By default these values are provided to the slurm template file:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">default_template_list</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  partition <span class="op">=</span> <span class="va">partition</span>,</span>
<span>  parallel <span class="op">=</span> <span class="va">parallel</span>,</span>
<span>  ncpu <span class="op">=</span> <span class="va">ncpu</span>,</span>
<span>  job_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s-nonmem-run"</span>, <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">.mod</span><span class="op">$</span><span class="va">absolute_model_path</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  project_path <span class="op">=</span> <span class="va">project_path</span>,</span>
<span>  project_name <span class="op">=</span> <span class="va">project_name</span>,</span>
<span>  bbi_exe_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.which.html" class="external-link">Sys.which</a></span><span class="op">(</span><span class="st">"bbi"</span><span class="op">)</span>,</span>
<span>  bbi_config_path <span class="op">=</span> <span class="va">bbi_config_path</span>,</span>
<span>  model_path <span class="op">=</span> <span class="va">.mod</span><span class="op">$</span><span class="va">absolute_model_path</span>,</span>
<span>  config_toml_path <span class="op">=</span> <span class="va">config_toml_path</span>,</span>
<span>  nmm_exe_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.which.html" class="external-link">Sys.which</a></span><span class="op">(</span><span class="st">"nmm"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<ul>
<li><p><code>partition</code> is an argument to
<code>submit_nonmem_model</code></p></li>
<li><p><code>parallel</code> is <code>TRUE</code> if
<code>ncpu &gt; 1</code>, else <code>FALSE</code></p></li>
<li><p><code>ncpu</code> is an argument to
<code>submit_nonmem_model</code></p></li>
<li><p><code>job_name</code> is created from the <code>.mod</code>
argument supplied to <code>submit_nonmem_model</code></p></li>
<li><p><code>bbi_exe_path</code> is determined via
`Sys.which(“bbi”)</p></li>
<li><p><code>bbi_config_path</code> is determined via
getOption(“slurmtools.bbi_config_path”)</p></li>
<li><p><code>model_path</code> is determined from the <code>.mod</code>
argument supplied to <code>submit_nonmem_model</code></p></li>
<li><p><code>config_toml_path</code> is determined from the
<code>.mod</code> argument supplied to <code>submit_nonmem_model</code>
and is requried to use <code>nmm</code> (NONMEM monitor)</p></li>
<li><p><code>nmm_exe_path</code> is determined via
<code>Sys.which("nmm")</code></p></li>
</ul>
<p>If you need to feed more arguments to the template you simply supply
them in the <code>slurm_template_opts</code> argument as a list. More on
that later.</p>
</div>
<div class="section level3">
<h3 id="submitting-a-nonmem-job-with-bbi">Submitting a NONMEM job with <code>bbi</code><a class="anchor" aria-label="anchor" href="#submitting-a-nonmem-job-with-bbi"></a>
</h3>
<p>To submit a NONMEM job, we need to supply either the path to a mod
file or create a model object from <code>bbr</code>, and supply a
<code>slurm-template.tmpl</code> file. To use <code>bbi</code> we also
need a <code>bbi.yaml</code> file, which I’ve also supplied in
<code>/model/nonmem/bbi.yaml</code> (and is also supplied with the R
project starter).</p>
<p>Here is an example of a template file that will call
<code>bbi</code>:</p>
<pre class="slurm-job-bbi.tmpl"><code>#!/bin/bash
#SBATCH --job-name="{{job_name}}"
#SBATCH --nodes=1
#SBATCH --ntasks=1
#SBATCH --cpus-per-task={{ncpu}}
#SBATCH --partition={{partition}}
#SBATCH --account={{project_name}}

# submit_nonmem_model uses the whisker package to populate template files
# https://github.com/edwindj/whisker

{{#parallel}}
{{bbi_exe_path}} nonmem run local {{model_path}}.mod --parallel --threads={{ncpu}} --config {{bbi_config_path}}
{{/parallel}}


{{^parallel}}
{{bbi_exe_path}} nonmem run local {{model_path}}.mod --config {{bbi_config_path}}
{{/parallel}}</code></pre>
<p>This file will call <code>bbi</code> to run our supplied model
(<code>{{model_path}}.mod</code>) if <code>ncpu &gt; 1</code> then
parallel will be true and the code between <code>{{#parallel}}</code>
and <code>{{/parallel}}</code> will be populated. if
<code>ncpu = 1</code> then parallel will be false and the code between
<code>{{^parallel}}</code> and <code>{{/parallel}}</code> will be
populated. By default, <code>submit_nonmem_model</code> will inject
<code>Sys.which("bbi")</code> into the template, so if <code>bbi</code>
is not on your path we’ll have to supply the <code>bbi_exe_path</code>
for it to start the NONMEM run.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Sys.which.html" class="external-link">Sys.which</a></span><span class="op">(</span><span class="st">"bbi"</span><span class="op">)</span></span>
<span><span class="va">bbi</span> </span>
<span> <span class="st">""</span> </span></code></pre></div>
<p>We will use a few different template files with different
functionality so we’ll inject those template file paths to
<code>submit_nonmem_model</code>. However, we’ll use the
<code>submission-log</code> directory for the output, so we’ll set that
option as well as <code>bbi_config_path</code> so
<code>submit_nonmem_model</code> defaults can be used. The slurm
template files are saved in <code>~/model/nonmem/</code> Additionally,
there is a simple NONMEM control stream in <code>1001.mod</code> in the
same directory that we can use for testing.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">library</span>(bbr)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="fu">here</span>() starts at <span class="sc">/</span>home<span class="sc">/</span>runner<span class="sc">/</span>work<span class="sc">/</span>slurmtools<span class="sc">/</span>slurmtools</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>nonmem <span class="ot">=</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">"vignettes"</span>, <span class="st">"model"</span>, <span class="st">"nonmem"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="fu">options</span>(<span class="st">'slurmtools.submission_root'</span> <span class="ot">=</span> <span class="fu">file.path</span>(nonmem, <span class="st">"submission-log"</span>))</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="fu">options</span>(<span class="st">'slurmtools.bbi_config_path'</span> <span class="ot">=</span> <span class="fu">file.path</span>(nonmem, <span class="st">"bbi.yaml"</span>))</span></code></pre></div>
<p>To create the <code>bbr</code> model object, we need to have both
<code>1001.mod</code> and <code>1001.yaml</code> which contains metadata
about the model in the supplied directory
(<code>./model/nonmem/</code>). We’ll check for mod_number.yaml and if
it exists, read in the model otherwise create it and then read it.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_number</span> <span class="op">&lt;-</span> <span class="st">"1001"</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">nonmem</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">mod_number</span>, <span class="st">".yaml"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">bbr</span><span class="fu">::</span><span class="fu"><a href="https://metrumresearchgroup.github.io/bbr/reference/read_model.html" class="external-link">read_model</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">nonmem</span>, <span class="va">mod_number</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">bbr</span><span class="fu">::</span><span class="fu"><a href="https://metrumresearchgroup.github.io/bbr/reference/new_model.html" class="external-link">new_model</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">nonmem</span>, <span class="va">mod_number</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We can now submit the job and point to the template file in
<code>model/nonmem/slurm-job-bbi.tmpl</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>submission <span class="ot">&lt;-</span> slurmtools<span class="sc">::</span><span class="fu">submit_nonmem_model</span>(</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  mod,</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="at">slurm_job_template_path =</span> <span class="fu">file.path</span>(nonmem, <span class="st">"slurm-job-bbi.tmpl"</span>),</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>)</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>submission</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="sc">$</span>status</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">0</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="sc">$</span>stdout</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Submitted batch job 804</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="sc">$</span>stderr</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">""</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="sc">$</span>timeout</span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">FALSE</span></span></code></pre></div>
<p>We see a <code>status</code> with an exit code of 0 suggesting a
successful command, and the <code>stdout</code> gives us the batch job
number. We can use <code><a href="../reference/get_slurm_jobs.html">slurmtools::get_slurm_jobs()</a></code> to monitor
the status of the job. Here, we can supply the user = “matthews”
argument to filter to just the jobs I’ve submitted.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>slurmtools<span class="sc">::</span><span class="fu">get_slurm_jobs</span>(<span class="at">user =</span> <span class="st">'matthews'</span>)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="sc">$</span>submit_time</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>POSIXct of length <span class="dv">0</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="sc">$</span>start_time</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>POSIXct of length <span class="dv">0</span></span></code></pre></div>
<p>If we look in the <code>slurmtools.submisstion_root</code> directory
we can see the shell script that was generated with
<code>submit_nonmem_model</code>. Here is the whisker replaced call to
bbi:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode 1001.sh"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="ex">/usr/local/bin/bbi</span> nonmem run local /cluster-data/user-homes/matthews/Projects/slurmtools_vignette/model/nonmem/1001.mod <span class="at">--config</span> /cluster-data/user-homes/matthews/Projects/slurmtools_vignette/model/nonmem/bbi.yaml</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="extending-templates">Extending templates<a class="anchor" aria-label="anchor" href="#extending-templates"></a>
</h3>
<p>Because the templates create a bash shell script there is an almost
infinite number of things we can do with our template. <strong>Anything
you can do in bash you can do by appropriately updating the template
file and injecting the needed information!</strong></p>
<p>Let’s add a notification feature that will send a notification when
the job has started and finished. We can use <a href="ntfy.sh">ntfy.sh</a> and add the necessary info to our template to
achieve this.</p>
<p>Here is a modified template file that adds a
<code>JOBID=$SLURM_JOBID</code> and some ntfy calls. To get a
notification we can supply <code>submit_nonmem_model</code> with
<code>ntfy</code> variable to send notifications. I’ll use
<code>ntfy = ntfy_demo</code> for this.</p>
<pre class="slurm-job-bbi-ntfy.tmpl"><code>#!/bin/bash
#SBATCH --job-name="{{job_name}}"
#SBATCH --nodes=1
#SBATCH --ntasks=1
#SBATCH --cpus-per-task={{ncpu}}
#SBATCH --partition={{partition}}
#SBATCH --account={{project_name}}

JOBID=$SLURM_JOBID

# submit_nonmem_model uses the whisker package to populate template files
# https://github.com/edwindj/whisker

{{#ntfy}}
curl -d "Starting model run: {{job_name}} $JOBID" ntfy.sh/{{ntfy}}
{{/ntfy}}

{{#parallel}}
{{bbi_exe_path}} nonmem run local {{model_path}}.mod --parallel --threads={{ncpu}} --config {{bbi_config_path}}
{{/parallel}}

{{^parallel}}
{{bbi_exe_path}} nonmem run local {{model_path}}.mod --config {{bbi_config_path}}
{{/parallel}}

{{#ntfy}}
curl -d "Finished model run: {{job_name}} $JOBID" ntfy.sh/{{ntfy}}
{{/ntfy}}</code></pre>
<p>Since we’ve already run this model we will provide the
<code>overwrite = TRUE</code> argument to force a new nonmem run.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>submission_ntfy <span class="ot">&lt;-</span> slurmtools<span class="sc">::</span><span class="fu">submit_nonmem_model</span>(</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  mod, </span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="at">slurm_job_template_path =</span> <span class="fu">file.path</span>(nonmem, <span class="st">"slurm-job-bbi-ntfy.tmpl"</span>),</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>  <span class="at">slurm_template_opts =</span> <span class="fu">list</span>(</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>    <span class="at">ntfy =</span> <span class="st">"ntfy_demo"</span>)</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>)</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>submission_ntfy</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="sc">$</span>status</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">0</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="sc">$</span>stdout</span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Submitted batch job 804</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="sc">$</span>stderr</span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">""</span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a><span class="sc">$</span>timeout</span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">FALSE</span></span></code></pre></div>
<p>We again get a 0 exit code status and now instead of using
<code><a href="../reference/get_slurm_jobs.html">slurmtools::get_slurm_jobs()</a></code> to monitor the job, we can
rely on the new notifications we just set up. <img src="data/images/ntfy_starting.png" alt="NONMEM job starting ntfy alert"></p>
<p>and when the run finished we get another notification: <img src="data/images/ntfy_finished.png" alt="NONMEM Job finished ntfy alert"></p>
<p>Note that the run number will match the run specified in
<code>submission$stdout</code>. We can see the new shell script this
updated template file generated</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode 1001.sh"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co">#SBATCH --job-name="1001-nonmem-run"</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co">#SBATCH --nodes=1</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co">#SBATCH --ntasks=1</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co">#SBATCH --cpus-per-task=1</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="co">#SBATCH --partition=cpu2mem4gb</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co">#SBATCH --account=slurmtools</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="va">JOBID</span><span class="op">=</span><span class="va">$SLURM_JOBID</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-d</span> <span class="st">"Starting model run: 1001-nonmem-run </span><span class="va">$JOBID</span><span class="st">"</span> ntfy.sh/ntfy_demo</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="ex">/usr/local/bin/bbi</span> nonmem run local /cluster-data/user-homes/matthews/Projects/slurmtools_vignette/model/nonmem/1001.mod <span class="at">--config</span> /cluster-data/user-homes/matthews/Projects/slurmtools_vignette/model/nonmem/bbi.yaml</span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-d</span> <span class="st">"Finished model run: 1001-nonmem-run </span><span class="va">$JOBID</span><span class="st">"</span> ntfy.sh/ntfy_demo</span></code></pre></div>
<p>To reiterate, this template file is run as a bash shell script so
anything you can do in bash you can put into the template and pass the
needed arguments and customize the behavior to your liking.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Devin Pastoor, Jenna Elwing, Matthew Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
